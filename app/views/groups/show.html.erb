<p id="notice"><%= notice %></p>

<div class="group_show">
  <%= link_to image_tag(@group.image.url(:original)), @group.image.url, class: "icon_medium" %>
  <h1><%= @group.title %></h1>
  <p><%= @group.description %></p>

  <% if @mods.include?(current_user) %>
    <%= link_to 'Edit Group', edit_group_path(@group) %>
    <br>
  <% end %>

  <% if @members.include?(current_user) %>
    <%= link_to "Leave Group", group_user_path(user: current_user, group: @group), method: :delete, data: {confirm: "Are you sure you want to leave the group?"} %>
  <% else %>
    <% if @group.pending?(current_user) %>
    <p>You don't have permission to view this group!</p>
      (Request Pending...)
    <% elsif @group.is_private %>
    <p>You don't have permission to view this group!</p>
      <%= link_to 'Request to Join', group_users_path(user: current_user, group: @group, accepted: false), method: :create %>
    <% else %>
      <%= link_to 'Join Group', group_users_path(user: current_user, group: @group, accepted: true), method: :create %>
    <% end %>
  <% end %>
</div>
<br>

<% if !@group.is_private || @members.include?(current_user) %>
  <%= render "layouts/group_bar" %>
  <div class="scripts_container">
    <% if @members.include?(current_user) %>
    <span class="title" style="text-align: center;"><%= link_to 'Post Script(s) to Group', group_script_path(group: @group) %></span>
    <% end %>
    <% @scripts.each_slice(4) do |script_row| %>
      <div class="script_row">
        <% script_row.each do |script| %>
          <div class="script">
            <%= link_to image_tag('script_icon.png'), script, class: "icon_thumb" %>
            <br>
            <span class="title"><%= link_to script.title, script %></span>
            <br>
            By: <%= link_to script.user.username, script.user %>
            <br>
            <%= script.logline %>
            <% if script.user == current_user %>
            <br>
            <%= link_to 'Remove', group_script_path(script: script, group: @group), method: :delete, data: { confirm: 'Are you sure you want to remove this script from the group?  (Your script and notes will still be available to you)' } %>
            <% end %>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>

  <div class="comments_container">
    <% if @members.include?(current_user) %>
      <span class="title" style="text-align: center;"><p>Post Comment</p></span>
    <% end %>
    <% @comments.each_slice(4) do |comment_row| %>
      <div class="comment_row">
        <% comment_row.each do |comment| %>
          <div class="comment">
            <p><%= comment.content %></p>
            <%= link_to comment.user.username, comment.user %>
            <br>
            <%= comment.created_at %>
            <% if comment.user == current_user %>
              <br>
              <%= link_to 'Delete', comment_path(comment), method: :delete %>
            <% end %>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>

  <div class="members_container">
    <% @members.each_slice(4) do |user_row| %>
      <div class="member_row">
        <% user_row.each do |user| %>
          <div class="member">
          <%= link_to image_tag(user.avatar.url(:original)), user.avatar.url, class: "icon_thumb" %>
          <br>
          <span class="title"><%= link_to user.username, user %></span>
          <br>
          <% if @mods.include?(current_user)%>
            
            <% if user.accepted_member?(@group) %>
              (<%= link_to "Remove", group_user_path(user: user, group: @group), method: :delete, data: {confirm: "Are you sure you want to remove this user from the group?"} %>)
            <% else %>
              (<%= link_to "Add", group_user_path(user: user, group: @group, accepted: true), method: :patch %>)
            <% end %>
            
            <% if @mods.include?(user) && user.accepted_member?(@group) %>
              (<%= link_to "Demote", group_user_path(user: user, group: @group, create_mod: false), method: :patch %>)
            <% else %>
              (<%= link_to "Promote", group_user_path(user: user, group: @group, create_mod: true), method: :patch %>)
            
            <% end %>
          <% else %>
            
            <% if @mods.include?(user) %>
              (Mod)
            <%end%>

          <% end %>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>
<% end %>